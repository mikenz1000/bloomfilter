# bloomfilter

Some quick/basic experiments with bloom filters

For an overview of bloom filters see this article:
  "Space-efficient and exact de Bruijn graph representation based on a Bloom filter"
  http://almob.biomedcentral.com/articles/10.1186/1748-7188-8-22
or https://en.wikipedia.org/wiki/Bloom_filter

The goal of this project is to 
- test performance of different block sizes for the bit array (`uint8_t` .. `uint64_t`)
- test performance of `vector<bool>`
- experiment with different hash functions

Interestingly I found that the probability of false positives is higher (up to 9x!) than expected if I use std::hash 
vs. SpookyHash from http://burtleburtle.net/bob/hash/spooky.html

```
Determined m = 14377587, h = 10 for desired p(false +ve) 0.001
std::hash	 False positive rate **0.067031** versus expected 0.001000
SpookyHash False positive rate 0.000949 versus expected 0.001000

Determined m = 9585058, h = 7 for desired p(false +ve) 0.010000
std::hash  False positive rate **0.098459** versus expected 0.010039
SpookyHash False positive rate 0.010074 versus expected 0.010039

Determined m = 4792529, h = 4 for desired p(false +ve) 0.100000
std::hash  False positive rate **0.188301** versus expected 0.102603
SpookyHash False positive rate 0.102354 versus expected 0.102603
```


The weakness of std::hash may be exacerbated by the fact my data is generated by LCG...

Anyway as far as performance goes, using the better hash dominates the CPU time

```
vector<bool>:
	Filling took 1.452523s (1.452523e-07 x 10000000 its)
	Testing took 0.983000s (9.830005e-08 x 10000000 its)
vector<bool>, spooky hash:
	Filling took 6.749714s (6.749714e-07 x 10000000 its)
	Testing took 6.254350s (6.254350e-07 x 10000000 its)
```

So just looking at the cheaper hash because it will highlight the difference in performance of storage type:

```
64 bit blocks:
	Filling took 1.301402s (1.301402e-07 x 10000000 its)
	Testing took 0.750455s (7.504547e-08 x 10000000 its)
32 bit blocks:
	Filling took 1.307689s (1.307689e-07 x 10000000 its)
	Testing took 0.787167s (7.871670e-08 x 10000000 its)
16 bit blocks:
	Filling took 1.421501s (1.421501e-07 x 10000000 its)
	Testing took 0.755271s (7.552712e-08 x 10000000 its)
8 bit blocks:
	Filling took 1.319426s (1.319426e-07 x 10000000 its)
	Testing took 0.891759s (8.917585e-08 x 10000000 its)
vector<bool>:
	Filling took 1.452523s (1.452523e-07 x 10000000 its)
	Testing took 0.983000s (9.830005e-08 x 10000000 its)
```

So as expected on a 64-bit machine, slightly better performance with 64-bit blocks (20% vs vector<bool>)

To-do -> check the impact of byte alignment...
